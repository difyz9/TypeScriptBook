# 第2章：小程序项目结构

## 2.1 项目文件结构详解

### 标准项目结构

```
miniprogram-project/
├── app.js                    # 小程序逻辑
├── app.json                  # 小程序全局配置
├── app.wxss                  # 小程序全局样式
├── sitemap.json             # 索引配置文件
├── project.config.json      # 项目配置文件
├── pages/                   # 页面目录
│   ├── index/              # 首页
│   │   ├── index.js        # 页面逻辑
│   │   ├── index.json      # 页面配置
│   │   ├── index.wxml      # 页面结构
│   │   └── index.wxss      # 页面样式
│   └── detail/             # 详情页
│       ├── detail.js
│       ├── detail.json
│       ├── detail.wxml
│       └── detail.wxss
├── components/             # 自定义组件目录
│   └── custom-component/
│       ├── index.js
│       ├── index.json
│       ├── index.wxml
│       └── index.wxss
├── utils/                  # 工具函数目录
│   ├── util.js
│   └── api.js
├── images/                 # 图片资源目录
└── style/                  # 公共样式目录
    └── common.wxss
```

### 文件类型说明

#### 1. 框架文件
- **app.js**：小程序入口文件，定义全局应用逻辑
- **app.json**：小程序全局配置文件
- **app.wxss**：小程序全局样式文件

#### 2. 页面文件
每个页面由4个文件组成：
- **.js文件**：页面逻辑
- **.wxml文件**：页面结构
- **.wxss文件**：页面样式
- **.json文件**：页面配置

#### 3. 配置文件
- **project.config.json**：项目配置
- **sitemap.json**：搜索索引配置

## 2.2 全局配置文件app.json

### 基本结构

```json
{
  "pages": [
    "pages/index/index",
    "pages/detail/detail"
  ],
  "window": {
    "backgroundTextStyle": "light",
    "navigationBarBackgroundColor": "#fff",
    "navigationBarTitleText": "我的小程序",
    "navigationBarTextStyle": "black"
  },
  "tabBar": {
    "color": "#7A7E83",
    "selectedColor": "#3cc51f",
    "borderStyle": "black",
    "backgroundColor": "#ffffff",
    "list": [
      {
        "pagePath": "pages/index/index",
        "iconPath": "images/icon_home.png",
        "selectedIconPath": "images/icon_home_selected.png",
        "text": "首页"
      },
      {
        "pagePath": "pages/profile/profile",
        "iconPath": "images/icon_profile.png",
        "selectedIconPath": "images/icon_profile_selected.png",
        "text": "我的"
      }
    ]
  },
  "networkTimeout": {
    "request": 10000,
    "downloadFile": 10000
  },
  "debug": false
}
```

### 主要配置项详解

#### 1. pages - 页面路径列表
```json
{
  "pages": [
    "pages/index/index",    // 首页，数组第一项为小程序初始页面
    "pages/detail/detail",  // 详情页
    "pages/user/user"       // 用户页
  ]
}
```

**注意事项**：
- 数组第一项代表小程序的初始页面
- 新增页面需要在此配置
- 页面路径不需要写文件后缀

#### 2. window - 全局默认窗口表现
```json
{
  "window": {
    "navigationBarBackgroundColor": "#000000", // 导航栏背景颜色
    "navigationBarTextStyle": "white",         // 导航栏标题颜色
    "navigationBarTitleText": "小程序",         // 导航栏标题文字
    "backgroundColor": "#eeeeee",              // 窗口的背景色
    "backgroundTextStyle": "light",            // 下拉loading样式
    "enablePullDownRefresh": false,            // 是否开启下拉刷新
    "onReachBottomDistance": 50               // 页面上拉触底事件触发时距页面底部距离
  }
}
```

#### 3. tabBar - 底部选项卡配置
```json
{
  "tabBar": {
    "color": "#7A7E83",              // 未选中时的文字颜色
    "selectedColor": "#3cc51f",      // 选中时的文字颜色
    "backgroundColor": "#ffffff",     // 背景色
    "borderStyle": "black",          // 边框颜色
    "position": "bottom",            // 位置，可选值 bottom、top
    "list": [                        // tab 的列表，最少2个、最多5个
      {
        "pagePath": "pages/index/index",               // 页面路径
        "text": "首页",                                 // 按钮文字
        "iconPath": "images/icon_home.png",           // 未选中时的图标
        "selectedIconPath": "images/icon_home_hl.png" // 选中时的图标
      }
    ]
  }
}
```

#### 4. networkTimeout - 网络超时时间
```json
{
  "networkTimeout": {
    "request": 10000,        // wx.request的超时时间，单位毫秒
    "connectSocket": 10000,  // wx.connectSocket的超时时间
    "uploadFile": 10000,     // wx.uploadFile的超时时间
    "downloadFile": 10000    // wx.downloadFile的超时时间
  }
}
```

### 其他重要配置

#### 1. 权限设置
```json
{
  "permission": {
    "scope.userLocation": {
      "desc": "你的位置信息将用于小程序位置接口的效果展示"
    }
  }
}
```

#### 2. 分包配置
```json
{
  "subpackages": [
    {
      "root": "packageA",
      "pages": [
        "pages/cat/cat",
        "pages/dog/dog"
      ]
    }
  ]
}
```

## 2.3 页面配置文件详解

### 页面配置示例
```json
{
  "navigationBarTitleText": "页面标题",
  "navigationBarBackgroundColor": "#ffffff",
  "navigationBarTextStyle": "black",
  "backgroundColor": "#eeeeee",
  "backgroundTextStyle": "light",
  "enablePullDownRefresh": true,
  "onReachBottomDistance": 50,
  "backgroundColorTop": "#ffffff",
  "backgroundColorBottom": "#ffffff",
  "disableScroll": false
}
```

### 配置优先级
页面配置会覆盖app.json的window配置：
```
页面.json > app.json window配置
```

### 常用页面配置

#### 1. 自定义导航栏
```json
{
  "navigationStyle": "custom",  // 自定义导航栏
  "navigationBarTitleText": ""  // 必须设置为空
}
```

#### 2. 下拉刷新配置
```json
{
  "enablePullDownRefresh": true,
  "backgroundTextStyle": "dark"
}
```

#### 3. 分享配置
```json
{
  "shareElementId": "share-element"
}
```

## 2.4 样式文件组织

### 全局样式 app.wxss
```css
/* app.wxss */
/* 全局样式 */
page {
  background-color: #f8f8f8;
  font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, Roboto, 'PingFang SC', 'miui', 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif;
}

/* 通用布局类 */
.container {
  padding: 20rpx;
  min-height: 100vh;
  box-sizing: border-box;
}

.flex {
  display: flex;
}

.flex-center {
  display: flex;
  align-items: center;
  justify-content: center;
}

/* 通用文字类 */
.text-center {
  text-align: center;
}

.text-primary {
  color: #007aff;
}

.text-success {
  color: #4cd964;
}

.text-warning {
  color: #f0ad4e;
}

.text-danger {
  color: #dd524d;
}
```

### 页面样式示例
```css
/* pages/index/index.wxss */
.page-container {
  padding: 40rpx;
}

.header {
  text-align: center;
  margin-bottom: 40rpx;
}

.title {
  font-size: 48rpx;
  font-weight: bold;
  color: #333;
  margin-bottom: 20rpx;
}

.subtitle {
  font-size: 28rpx;
  color: #666;
}

.content {
  background: #fff;
  border-radius: 20rpx;
  padding: 40rpx;
  box-shadow: 0 2rpx 20rpx rgba(0, 0, 0, 0.1);
}
```

### 样式组织最佳实践

#### 1. 使用CSS变量
```css
/* app.wxss */
page {
  --primary-color: #007aff;
  --success-color: #4cd964;
  --warning-color: #f0ad4e;
  --danger-color: #dd524d;
  --text-color: #333;
  --border-color: #e5e5e5;
}

.button-primary {
  background-color: var(--primary-color);
}
```

#### 2. 模块化样式
```css
/* style/common.wxss */
@import "base.wxss";
@import "layout.wxss";
@import "components.wxss";
```

#### 3. 响应式设计
```css
/* 使用rpx实现响应式 */
.responsive-container {
  width: 750rpx; /* 始终等于屏幕宽度 */
  padding: 40rpx;
}

.responsive-grid {
  display: flex;
  flex-wrap: wrap;
}

.grid-item {
  width: 250rpx; /* 屏幕宽度的1/3 */
  height: 250rpx;
}
```

## 2.5 第一个Hello World小程序

### 创建项目步骤

#### 1. 初始化项目
1. 打开微信开发者工具
2. 新建小程序项目
3. 填写项目信息：
   - 项目名称：HelloWorld
   - 目录选择：选择空文件夹
   - AppID：填写您的小程序AppID
   - 开发模式：小程序

#### 2. 编写app.json
```json
{
  "pages": [
    "pages/index/index"
  ],
  "window": {
    "backgroundTextStyle": "light",
    "navigationBarBackgroundColor": "#fff",
    "navigationBarTitleText": "Hello World",
    "navigationBarTextStyle": "black"
  }
}
```

#### 3. 编写app.js
```javascript
// app.js
App({
  onLaunch() {
    console.log('小程序启动了！');
    
    // 展示本地存储能力
    const logs = wx.getStorageSync('logs') || [];
    logs.unshift(Date.now());
    wx.setStorageSync('logs', logs);

    // 登录
    wx.login({
      success: res => {
        console.log('登录成功', res.code);
      }
    });
  },
  
  globalData: {
    userInfo: null,
    version: '1.0.0'
  }
});
```

#### 4. 编写app.wxss
```css
/* app.wxss */
page {
  background-color: #f8f8f8;
  font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', Helvetica, Arial, sans-serif;
}

.container {
  padding: 40rpx;
  min-height: 100vh;
  box-sizing: border-box;
}
```

#### 5. 创建首页 pages/index/index.wxml
```xml
<!--pages/index/index.wxml-->
<view class="container">
  <view class="header">
    <image class="logo" src="/images/logo.png" mode="aspectFit"></image>
    <text class="title">Hello World!</text>
    <text class="subtitle">欢迎来到微信小程序世界</text>
  </view>
  
  <view class="content">
    <view class="info-item">
      <text class="label">当前时间：</text>
      <text class="value">{{currentTime}}</text>
    </view>
    
    <view class="info-item">
      <text class="label">用户昵称：</text>
      <text class="value">{{userInfo.nickName || '未登录'}}</text>
    </view>
    
    <button class="btn-primary" bindtap="getUserInfo">获取用户信息</button>
    <button class="btn-secondary" bindtap="showMessage">显示消息</button>
  </view>
</view>
```

#### 6. 编写首页逻辑 pages/index/index.js
```javascript
// pages/index/index.js
const app = getApp();

Page({
  data: {
    currentTime: '',
    userInfo: {}
  },

  onLoad() {
    console.log('页面加载完成');
    this.updateTime();
    
    // 获取全局数据
    if (app.globalData.userInfo) {
      this.setData({
        userInfo: app.globalData.userInfo
      });
    }
  },

  onShow() {
    console.log('页面显示');
  },

  // 更新当前时间
  updateTime() {
    const now = new Date();
    const timeString = now.toLocaleString('zh-CN');
    this.setData({
      currentTime: timeString
    });
  },

  // 获取用户信息
  getUserInfo() {
    wx.getUserProfile({
      desc: '用于完善会员资料',
      success: (res) => {
        console.log('获取用户信息成功', res);
        this.setData({
          userInfo: res.userInfo
        });
        
        // 保存到全局数据
        app.globalData.userInfo = res.userInfo;
        
        wx.showToast({
          title: '获取成功',
          icon: 'success'
        });
      },
      fail: (err) => {
        console.error('获取用户信息失败', err);
        wx.showToast({
          title: '获取失败',
          icon: 'error'
        });
      }
    });
  },

  // 显示消息
  showMessage() {
    wx.showModal({
      title: '提示',
      content: '这是我的第一个微信小程序！',
      confirmText: '太棒了',
      cancelText: '再看看',
      success: (res) => {
        if (res.confirm) {
          console.log('用户点击确定');
        } else if (res.cancel) {
          console.log('用户点击取消');
        }
      }
    });
  }
});
```

#### 7. 编写首页样式 pages/index/index.wxss
```css
/* pages/index/index.wxss */
.container {
  padding: 40rpx;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
}

.header {
  text-align: center;
  margin-bottom: 60rpx;
}

.logo {
  width: 120rpx;
  height: 120rpx;
  margin-bottom: 30rpx;
}

.title {
  display: block;
  font-size: 48rpx;
  font-weight: bold;
  color: #fff;
  margin-bottom: 20rpx;
}

.subtitle {
  display: block;
  font-size: 28rpx;
  color: rgba(255, 255, 255, 0.8);
}

.content {
  background: #fff;
  border-radius: 20rpx;
  padding: 40rpx;
  box-shadow: 0 10rpx 40rpx rgba(0, 0, 0, 0.1);
}

.info-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20rpx 0;
  border-bottom: 1rpx solid #f0f0f0;
  margin-bottom: 20rpx;
}

.info-item:last-of-type {
  border-bottom: none;
  margin-bottom: 40rpx;
}

.label {
  font-size: 28rpx;
  color: #666;
}

.value {
  font-size: 28rpx;
  color: #333;
  font-weight: 500;
}

.btn-primary,
.btn-secondary {
  width: 100%;
  margin-bottom: 20rpx;
  border-radius: 50rpx;
  height: 88rpx;
  line-height: 88rpx;
  font-size: 32rpx;
}

.btn-primary {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: #fff;
  border: none;
}

.btn-secondary {
  background: #fff;
  color: #667eea;
  border: 2rpx solid #667eea;
}

.btn-primary:active {
  opacity: 0.8;
}

.btn-secondary:active {
  background: #f8f9ff;
}
```

#### 8. 页面配置 pages/index/index.json
```json
{
  "navigationBarTitleText": "Hello World",
  "enablePullDownRefresh": true,
  "backgroundTextStyle": "dark"
}
```

### 运行和测试

1. **编译预览**：点击工具栏的"编译"按钮
2. **模拟器测试**：在模拟器中查看效果
3. **真机测试**：点击"预览"生成二维码，用微信扫码测试
4. **调试**：使用Console查看日志输出

## 本章小结

通过本章学习，您应该掌握：

1. ✅ 小程序项目的完整文件结构
2. ✅ app.json全局配置文件的各项配置
3. ✅ 页面配置文件的使用方法
4. ✅ 样式文件的组织和最佳实践
5. ✅ 创建完整的Hello World小程序

## 实践练习

### 练习1：配置修改
1. 修改app.json，添加一个新页面
2. 配置底部tabBar，包含两个选项卡
3. 自定义导航栏样式

### 练习2：样式优化
1. 创建公共样式文件
2. 使用CSS变量定义主题色
3. 实现响应式布局

### 练习3：功能扩展
1. 在Hello World基础上添加新功能
2. 使用本地存储保存用户数据
3. 添加页面间跳转功能

## 常见问题

### Q1: 新增页面后为什么不显示？
A: 需要在app.json的pages数组中注册页面路径。

### Q2: 样式不生效怎么办？
A: 检查样式文件路径是否正确，确保选择器写法正确。

### Q3: tabBar图标不显示？
A: 检查图片路径是否正确，图片尺寸建议40px*40px。

### Q4: 页面配置不生效？
A: 确保页面配置文件名与页面文件名一致，JSON格式正确。

---

**下一章预告**：第3章将深入学习WXML语法和数据绑定机制，这是小程序开发的核心技能。

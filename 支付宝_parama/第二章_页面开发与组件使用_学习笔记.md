# 第二章：页面开发与组件使用 - 学习笔记

## 2.1 页面结构和布局

### 页面结构设计原则

#### 1. 层次结构清晰
```xml
<!-- 良好的页面结构示例 -->
<view class="page">
  <!-- 头部导航 -->
  <view class="header">
    <view class="nav-bar">
      <text class="title">页面标题</text>
    </view>
  </view>
  
  <!-- 主体内容 -->
  <view class="content">
    <view class="section">
      <view class="section-title">区块标题</view>
      <view class="section-body">区块内容</view>
    </view>
  </view>
  
  <!-- 底部操作栏 -->
  <view class="footer">
    <button class="action-btn">确定</button>
  </view>
</view>
```

#### 2. 语义化命名
- 使用有意义的class名称
- 遵循BEM命名规范
- 保持命名一致性

### Flex布局应用

#### 基础Flex概念
```css
/* 父容器属性 */
.flex-container {
  display: flex;
  flex-direction: row;        /* 主轴方向: row | column */
  justify-content: center;    /* 主轴对齐: flex-start | center | flex-end | space-between */
  align-items: center;        /* 交叉轴对齐: flex-start | center | flex-end | stretch */
  flex-wrap: nowrap;         /* 换行: nowrap | wrap */
}

/* 子元素属性 */
.flex-item {
  flex: 1;                   /* 弹性伸缩: flex-grow flex-shrink flex-basis */
  order: 0;                  /* 排序 */
  align-self: auto;          /* 单独对齐 */
}
```

#### 常用Flex布局模式

**1. 水平居中布局**
```css
.horizontal-center {
  display: flex;
  justify-content: center;
  align-items: center;
}
```

**2. 两栏布局**
```css
.two-column {
  display: flex;
}

.sidebar {
  width: 200px;
  flex-shrink: 0;
}

.main {
  flex: 1;
}
```

**3. 底部固定布局**
```css
.page {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
}

.content {
  flex: 1;
}

.footer {
  height: 60px;
  flex-shrink: 0;
}
```

### 响应式设计

#### 设备适配方案
```css
/* 使用rpx单位进行适配 */
.responsive-container {
  width: 750rpx;          /* 750rpx = 100%屏幕宽度 */
  padding: 20rpx;
  font-size: 28rpx;
}

/* 媒体查询 */
@media (max-width: 400px) {
  .responsive-text {
    font-size: 24rpx;
  }
}

@media (min-width: 600px) {
  .responsive-text {
    font-size: 32rpx;
  }
}
```

#### 屏幕尺寸适配
```javascript
// 获取设备信息
Page({
  onLoad() {
    const systemInfo = my.getSystemInfoSync();
    console.log('屏幕宽度:', systemInfo.screenWidth);
    console.log('屏幕高度:', systemInfo.screenHeight);
    console.log('像素比:', systemInfo.pixelRatio);
    
    // 根据屏幕尺寸调整布局
    if (systemInfo.screenWidth < 400) {
      this.setData({
        layoutClass: 'small-screen'
      });
    }
  }
});
```

### 常用布局模式

#### 1. 卡片式布局
```xml
<view class="card-container">
  <view class="card" a:for="{{cardList}}">
    <image class="card-image" src="{{item.image}}" />
    <view class="card-content">
      <text class="card-title">{{item.title}}</text>
      <text class="card-desc">{{item.description}}</text>
    </view>
  </view>
</view>
```

```css
.card-container {
  padding: 20rpx;
}

.card {
  background: white;
  border-radius: 8rpx;
  box-shadow: 0 2rpx 8rpx rgba(0,0,0,0.1);
  margin-bottom: 20rpx;
  overflow: hidden;
}

.card-image {
  width: 100%;
  height: 300rpx;
}

.card-content {
  padding: 20rpx;
}
```

#### 2. 网格布局
```xml
<view class="grid-container">
  <view class="grid-item" a:for="{{gridList}}">
    <image class="grid-icon" src="{{item.icon}}" />
    <text class="grid-text">{{item.name}}</text>
  </view>
</view>
```

```css
.grid-container {
  display: flex;
  flex-wrap: wrap;
  padding: 20rpx;
}

.grid-item {
  width: 25%;
  text-align: center;
  padding: 20rpx 0;
  box-sizing: border-box;
}

.grid-icon {
  width: 60rpx;
  height: 60rpx;
  margin-bottom: 10rpx;
}
```

#### 3. 列表布局
```xml
<view class="list-container">
  <view class="list-item" a:for="{{listData}}">
    <view class="item-left">
      <image class="avatar" src="{{item.avatar}}" />
      <view class="item-info">
        <text class="item-title">{{item.title}}</text>
        <text class="item-subtitle">{{item.subtitle}}</text>
      </view>
    </view>
    <view class="item-right">
      <text class="item-value">{{item.value}}</text>
    </view>
  </view>
</view>
```

---

## 2.2 基础组件详解

### 视图容器组件

#### 1. view组件
```xml
<!-- 基础容器组件 -->
<view class="container" 
      onTap="onViewTap"
      onLongTap="onViewLongTap">
  <text>这是一个view容器</text>
</view>
```

**主要属性：**
- `onTap`: 点击事件
- `onLongTap`: 长按事件
- `catchTap`: 阻止事件冒泡
- `class`: 样式类名
- `style`: 内联样式

#### 2. scroll-view组件
```xml
<!-- 可滚动视图 -->
<scroll-view 
  class="scroll-area"
  scroll-y="{{true}}"
  scroll-top="{{scrollTop}}"
  onScrollToUpper="onScrollToUpper"
  onScrollToLower="onScrollToLower"
  onScroll="onScroll">
  
  <view a:for="{{longList}}" class="scroll-item">
    <text>{{item}}</text>
  </view>
</scroll-view>
```

**核心属性：**
- `scroll-x/scroll-y`: 横向/纵向滚动
- `scroll-top/scroll-left`: 滚动位置
- `onScrollToUpper/Lower`: 滚动到顶部/底部事件
- `enable-back-to-top`: 支持返回顶部

#### 3. swiper组件
```xml
<!-- 轮播图组件 -->
<swiper 
  class="swiper"
  autoplay="{{true}}"
  interval="{{3000}}"
  circular="{{true}}"
  indicator-dots="{{true}}"
  onChange="onSwiperChange">
  
  <swiper-item a:for="{{bannerList}}">
    <image class="swiper-image" src="{{item.image}}" />
  </swiper-item>
</swiper>
```

```javascript
Page({
  data: {
    bannerList: [
      { image: '/images/banner1.jpg' },
      { image: '/images/banner2.jpg' },
      { image: '/images/banner3.jpg' }
    ]
  },
  
  onSwiperChange(e) {
    console.log('当前轮播项:', e.detail.current);
  }
});
```

### 基础内容组件

#### 1. text组件
```xml
<!-- 文本组件 -->
<text class="text-normal">普通文本</text>
<text class="text-selectable" selectable="{{true}}">可选择文本</text>
<text class="text-decode" decode="{{true}}">HTML实体: &amp; &lt; &gt;</text>
```

**属性说明：**
- `selectable`: 文本是否可选
- `decode`: 是否解码HTML实体
- `space`: 空格处理方式

#### 2. rich-text组件
```xml
<!-- 富文本组件 -->
<rich-text nodes="{{richTextContent}}"></rich-text>
```

```javascript
Page({
  data: {
    richTextContent: [
      {
        name: 'div',
        attrs: {
          class: 'rich-text-container'
        },
        children: [
          {
            name: 'h2',
            children: [{
              type: 'text',
              text: '富文本标题'
            }]
          },
          {
            name: 'p',
            children: [{
              type: 'text',
              text: '这是一段富文本内容，支持HTML标签。'
            }]
          }
        ]
      }
    ]
  }
});
```

#### 3. progress组件
```xml
<!-- 进度条组件 -->
<progress 
  percent="{{progressValue}}"
  show-info="{{true}}"
  border-radius="{{5}}"
  font-size="{{16}}"
  stroke-width="{{8}}"
  color="#1677FF"
  backgroundColor="#f5f5f5"
  active="{{true}}" />
```

### 表单组件

#### 1. input组件
```xml
<!-- 输入框组件 -->
<input 
  class="input-field"
  placeholder="请输入内容"
  placeholder-class="input-placeholder"
  value="{{inputValue}}"
  type="text"
  maxlength="{{20}}"
  focus="{{inputFocus}}"
  onInput="onInputChange"
  onFocus="onInputFocus"
  onBlur="onInputBlur"
  onConfirm="onInputConfirm" />
```

**输入类型：**
- `text`: 文本输入
- `number`: 数字输入
- `digit`: 带小数点的数字
- `tel`: 电话号码
- `email`: 邮箱地址
- `password`: 密码输入

#### 2. textarea组件
```xml
<!-- 多行文本输入 -->
<textarea 
  class="textarea-field"
  placeholder="请输入多行文本"
  value="{{textareaValue}}"
  maxlength="{{200}}"
  show-count="{{true}}"
  auto-height="{{true}}"
  onInput="onTextareaInput" />
```

#### 3. picker组件
```xml
<!-- 选择器组件 -->
<picker 
  mode="selector"
  range="{{selectorList}}"
  value="{{selectorIndex}}"
  onChange="onPickerChange">
  <view class="picker-trigger">
    <text>当前选择: {{selectorList[selectorIndex]}}</text>
  </view>
</picker>

<!-- 时间选择器 -->
<picker 
  mode="time"
  value="{{timeValue}}"
  onChange="onTimeChange">
  <view class="picker-trigger">
    <text>选择时间: {{timeValue}}</text>
  </view>
</picker>

<!-- 日期选择器 -->
<picker 
  mode="date"
  value="{{dateValue}}"
  start="2020-01-01"
  end="2030-12-31"
  onChange="onDateChange">
  <view class="picker-trigger">
    <text>选择日期: {{dateValue}}</text>
  </view>
</picker>
```

```javascript
Page({
  data: {
    selectorList: ['选项1', '选项2', '选项3'],
    selectorIndex: 0,
    timeValue: '12:00',
    dateValue: '2024-01-01'
  },
  
  onPickerChange(e) {
    this.setData({
      selectorIndex: e.detail.value
    });
  },
  
  onTimeChange(e) {
    this.setData({
      timeValue: e.detail.value
    });
  },
  
  onDateChange(e) {
    this.setData({
      dateValue: e.detail.value
    });
  }
});
```

### 媒体组件

#### 1. image组件
```xml
<!-- 图片组件 -->
<image 
  class="image-container"
  src="{{imageSrc}}"
  mode="aspectFill"
  lazy-load="{{true}}"
  onLoad="onImageLoad"
  onError="onImageError"
  onTap="onImageTap" />
```

**显示模式：**
- `scaleToFill`: 拉伸填满
- `aspectFit`: 保持比例适应
- `aspectFill`: 保持比例填满
- `widthFix`: 宽度不变，高度自动
- `heightFix`: 高度不变，宽度自动

#### 2. video组件
```xml
<!-- 视频组件 -->
<video 
  class="video-player"
  src="{{videoSrc}}"
  poster="{{videoPoster}}"
  autoplay="{{false}}"
  loop="{{false}}"
  muted="{{false}}"
  controls="{{true}}"
  object-fit="contain"
  onPlay="onVideoPlay"
  onPause="onVideoPause"
  onEnded="onVideoEnded"
  onError="onVideoError" />
```

#### 3. camera组件
```xml
<!-- 相机组件 -->
<camera 
  class="camera-view"
  device-position="back"
  flash="off"
  frame-size="medium"
  onReady="onCameraReady"
  onError="onCameraError">
  
  <!-- 自定义操作按钮 -->
  <view class="camera-controls">
    <button onTap="takePhoto">拍照</button>
    <button onTap="startRecord">录像</button>
  </view>
</camera>
```

```javascript
Page({
  onLoad() {
    // 创建相机上下文
    this.cameraContext = my.createCameraContext();
  },
  
  takePhoto() {
    this.cameraContext.takePhoto({
      quality: 'high',
      success: (res) => {
        console.log('拍照成功:', res.tempImagePath);
        this.setData({
          photoPath: res.tempImagePath
        });
      }
    });
  },
  
  startRecord() {
    this.cameraContext.startRecord({
      success: () => {
        console.log('开始录像');
      }
    });
  }
});
```

### 地图组件

#### map组件使用
```xml
<!-- 地图组件 -->
<map 
  class="map-container"
  longitude="{{longitude}}"
  latitude="{{latitude}}"
  scale="{{16}}"
  markers="{{markers}}"
  polyline="{{polyline}}"
  circles="{{circles}}"
  show-location="{{true}}"
  enable-3D="{{true}}"
  onMarkerTap="onMarkerTap"
  onCalloutTap="onCalloutTap"
  onRegionChange="onRegionChange" />
```

```javascript
Page({
  data: {
    longitude: 120.131441,
    latitude: 30.279383,
    markers: [
      {
        id: 1,
        longitude: 120.131441,
        latitude: 30.279383,
        title: '我的位置',
        iconPath: '/images/marker.png',
        width: 30,
        height: 30,
        callout: {
          content: '这里是杭州',
          color: '#000',
          fontSize: 14,
          borderRadius: 5,
          bgColor: '#fff',
          padding: 10,
          display: 'ALWAYS'
        }
      }
    ],
    polyline: [
      {
        points: [
          { longitude: 120.131441, latitude: 30.279383 },
          { longitude: 120.128894, latitude: 30.278329 }
        ],
        color: '#FF0000',
        width: 4,
        dottedLine: false
      }
    ]
  },
  
  onLoad() {
    // 获取当前位置
    my.getLocation({
      type: 'gcj02',
      success: (res) => {
        this.setData({
          longitude: res.longitude,
          latitude: res.latitude
        });
      }
    });
  },
  
  onMarkerTap(e) {
    console.log('点击标记:', e.detail.markerId);
  }
});
```

---

## 学习要点总结

### 核心概念
- 页面结构设计的层次性和语义化
- Flex布局的基本原理和应用场景
- 响应式设计的实现方案
- 各类基础组件的特点和用法

### 实践技能
- 能够设计清晰的页面结构
- 熟练使用Flex布局实现各种布局需求
- 掌握常用组件的属性和事件处理
- 能够根据需求选择合适的组件

### 最佳实践
1. **结构设计**: 保持页面结构简洁清晰，避免过度嵌套
2. **样式规范**: 使用rpx单位进行适配，保持样式一致性
3. **组件选择**: 根据实际需求选择最合适的组件
4. **性能考虑**: 合理使用lazy-load等性能优化属性

### 常见问题
1. **布局适配**: 不同设备屏幕尺寸的适配问题
2. **事件处理**: 理解事件冒泡和阻止机制
3. **组件限制**: 了解各组件的使用限制和注意事项
4. **样式层叠**: 避免样式冲突和覆盖问题
